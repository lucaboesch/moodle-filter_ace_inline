define("filter_ace_inline/local/file_helpers",["exports","filter_ace_inline/local/utils"],(function(_exports,_utils){function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.setupFileHandler=_exports.getFiles=void 0;var _ref,uploadFiles={},getFiles=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(uiParameters){var uploadId,taids,sandboxArgs,map,filename,id,file,name;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(uploadId=uiParameters.paramsMap["file-upload-id"],taids=uiParameters.paramsMap["file-taids"],sandboxArgs=[],map={},0===Object.keys(taids).length){_context.next=25;break}_context.prev=5,taids=JSON.parse(taids),_context.next=12;break;case 9:return _context.prev=9,_context.t0=_context.catch(5),_context.abrupt("return",Promise.resolve("error"));case 12:_context.t1=regeneratorRuntime.keys(taids);case 13:if((_context.t2=_context.t1()).done){_context.next=25;break}if(filename=_context.t2.value,!taids.hasOwnProperty(filename)){_context.next=23;break}if(id=taids[filename],null!==(file=document.querySelector("#"+id))){_context.next=22;break}return _context.abrupt("return",Promise.resolve("bad_id"));case 22:map[filename]=file.value;case 23:_context.next=13;break;case 25:for(name in uploadFiles)uploadFiles.hasOwnProperty(name)&&uploadFiles[name].hasOwnProperty(uploadId)&&(map[name]=uploadFiles[name][uploadId],sandboxArgs.push(name));return uiParameters.setSandboxParams(sandboxArgs),_context.abrupt("return",Promise.resolve(JSON.stringify(map)));case 28:case"end":return _context.stop()}}),_callee,null,[[5,9]])}))),function(_x){return _ref.apply(this,arguments)});_exports.getFiles=getFiles;var _ref2,setupFileHandler=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(uploadElementId){var errorNode,errorHtml,fatalHtml,element;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:errorNode=document.createElement("div",[],{hidden:"1"}),errorHtml=(0,_utils.createComponent)("div",["filter-ace-inline-files"],{hidden:"1"}),fatalHtml=(0,_utils.createComponent)("div",["filter-ace-inline-file-error"],{hidden:"1"}),errorNode.appendChild(fatalHtml),errorNode.appendChild(errorHtml),(element=document.querySelector("#"+uploadElementId)).parentNode.insertBefore(errorNode,element.nextSibling),element.setAttribute("multiple","1"),element.addEventListener("change",_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var files,_iterator,_step,_loop;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:errorHtml.innerHTML="",fatalHtml.innerHTML="",uploadFiles={},files=element.files,_iterator=_createForOfIteratorHelper(files),_context3.prev=5,_loop=regeneratorRuntime.mark((function _loop(){var file,fileValues,parsedName;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return file=_step.value,fileValues={},parsedName=parseFileName(file.name),_context2.next=5,readOneFile(file).then((function(result){return parsedName!==file.name&&(errorHtml.innerHTML="<li><em>"+file.name+"</em><strong>&nbsp;&rArr;&nbsp;"+parsedName+"</strong></li>"+errorHtml.innerHTML),fileValues[uploadElementId]=result,null})).catch((function(){fatalHtml.innerHTML="<li><strong><em>"+file.name+"</em>&nbsp;</strong></li>"+fatalHtml.innerHTML}));case 5:0!==fileValues.size&&(uploadFiles[parsedName]=fileValues);case 6:case"end":return _context2.stop()}}),_loop)})),_iterator.s();case 8:if((_step=_iterator.n()).done){_context3.next=12;break}return _context3.delegateYield(_loop(),"t0",10);case 10:_context3.next=8;break;case 12:_context3.next=17;break;case 14:_context3.prev=14,_context3.t1=_context3.catch(5),_iterator.e(_context3.t1);case 17:return _context3.prev=17,_iterator.f(),_context3.finish(17);case 20:displayAllFileErrors(errorNode,errorHtml,fatalHtml);case 21:case"end":return _context3.stop()}}),_callee2,null,[[5,14,17,20]])}))));case 9:case"end":return _context4.stop()}}),_callee3)}))),function(_x2){return _ref2.apply(this,arguments)});_exports.setupFileHandler=setupFileHandler;var _ref4,_ref5,readOneFile=(_ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(file){return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(!(file.size>2097152)){_context5.next=2;break}return _context5.abrupt("return",Promise.reject("excessive size"));case 2:return _context5.abrupt("return",new Promise((function(resolve,reject){var rdr=new FileReader;rdr.onload=function(){resolve(rdr.result)},rdr.onerror=reject,rdr.readAsText(file)})));case 3:case"end":return _context5.stop()}}),_callee4)}))),function(_x3){return _ref4.apply(this,arguments)}),displayFileError=(_ref5=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(error,errorHtml){return regeneratorRuntime.wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,(0,_utils.getLangString)(error);case 2:_context6.t0=_context6.sent,_context6.t1="<strong>"+_context6.t0,_context6.t2=_context6.t1+"</strong><ul>",_context6.t3=errorHtml.innerHTML,_context6.t4=_context6.t2+_context6.t3,errorHtml.innerHTML=_context6.t4+"</ul>",errorHtml.removeAttribute("hidden");case 9:case"end":return _context6.stop()}}),_callee5)}))),function(_x4,_x5){return _ref5.apply(this,arguments)}),displayAllFileErrors=function(errorNode,errorHtml,fatalHtml){errorHtml.setAttribute("hidden","1"),fatalHtml.setAttribute("hidden","1"),""!==errorHtml.innerHTML||""!==fatalHtml.innerHTML?(""!==errorHtml.innerHTML&&displayFileError("file_changed_name",errorHtml),""!==fatalHtml.innerHTML&&displayFileError("file_not_uploaded",fatalHtml),errorNode.removeAttribute("hidden")):errorNode.setAttribute("hidden","1")},parseFileName=function(filename){return filename.replace(/\s/g,"_").replace(/[^A-Za-z0-9._-]/g,"")}}));

//# sourceMappingURL=file_helpers.min.js.map